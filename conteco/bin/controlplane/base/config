#!/usr/bin/env bash
if [[ "$1" == "for-each-node" ]] ; then
(
	shift
    . executionplane-invoke "$0 $@"
	if [[ $# -gt 1 ]] ; then
		rootPath="/conteco/pwd/${BASH_ARGV[0]}"
	else
		rootPath="/conteco/pwd/$1"
	fi
	imageName="${CONTECO_REALM}/${CONTECO_ECOSYSTEM}.${CONTECO_TYPE}.${CONTECO_NAME}"
	case $1 in
		build)
			(
			export CONTECO_REGISTRY=
			cat $rootPath/Dockerfile | envsubst > $rootPath/Dockerfile.static
			)
			;;
		increment)
			config-increment $2 $rootPath
			;;
		remove-crs)
			config-remove-crs $rootPath
			;;
		set-version)
			config-set-version $2 $rootPath
			;;
		*)
			executionplane-error "Method not recognised: $1."
			;;
	esac
  executionplane-complete
)
else
  export PATH="$CONTECO_EXECUTIONPLANE_APIINTERNALPATH_BASE"
	for-each $(basename $0) $@
fi
