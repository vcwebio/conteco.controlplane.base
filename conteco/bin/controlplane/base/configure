#!/usr/bin/env bash
(
    . executionplane-invoke "bin/controlplane/base/configure $@"

    selector="${BASH_ARGV[0]}"
    if [[ -d $selector ]] ; then
        . ./$selector/environment
    else 
        . set-environment-from-selector $f
    fi

    method=$1
    case $method in
        load|unload)
            .image $method
            ;;
        forced-extract)
            echo ".container run -v $CONTECO_PWD_VOLUME:/infometis/pwd "$CONTECO_REALM/$CONTECO_ECOSYSTEM.$CONTECO_TYPE:$CONTECO_NAME" --executiontag ${CONTECO_EXECUTIONTAG} --interactive --extract"
            ;;
        labelandtag)
            current=$(pwd)
            part0=$(echo $current | cut -d '/' -f 4)
            lastpart=$(echo $current | rev | cut -d '/' -f 1 | rev)
            part1=$( echo $lastpart | cut -d '.' -f 1)
            part2=$( echo $lastpart | cut -d '.' -f 2)
            part3=$( echo $lastpart | cut -d '.' -f 3)
            echo ".container labelandtag '$part0/$part1.$part2:$part3'"
            ;;
        extract)
            echo ".container run -v $CONTECO_PWD_VOLUME:/conteco/pwd '$CONTECO_REALM/$CONTECO_ECOSYSTEM.$CONTECO_TYPE:$CONTECO_NAME' --executiontag ${CONTECO_EXECUTIONTAG} --interactive --extract"
            ;;
        *)
            . executionplane-error "Method needs repository node selection for execution."
            ;;
    esac

    . executionplane-complete
)
