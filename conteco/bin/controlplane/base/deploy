#!/usr/bin/env bash
if [[ "$1" == "for-each-node" ]] ; then
(
	shift
    . executionplane-invoke "$0 $@"
	# sets method executed by image specific handler.
	# three modes: --deploy, --remove and --redeploy
	if [[ $# -gt 1 ]] ; then
		method=$1
		if [[ "$method" != "--"* ]] ; then
			method="all"
		else
			shift
		fi
	else
		method="--deploy"
	fi
	imageName="${CONTECO_REALM}/${CONTECO_ECOSYSTEM}.${CONTECO_TYPE}.${CONTECO_NAME}"
	case $method in
        "deploy")
			if [[ "$2" == "--redeploy" || "$2" == "--remove" ]] ; then
				# implement remove
				executionplane-error "Method not implemented!"
			fi
			if [[ "$2" != "--remove" ]] ; then
				# implement deploy
				executionplane-error "Method not implemented!"
			fi
			;;
		all)
			extract-and-execute $imageName deploy $@
			;;
	esac
	executionplane-complete
)
else
    export PATH="$CONTECO_EXECUTIONPLANE_APIINTERNALPATH"
	for-each $(basename $0) $@
fi
