#!/usr/bin/env bash
method=`basename "$0"`
arguments=$@
(
    . executionplane-invoke "$0 $@"
    imageName="${CONTECO_REALM}/${CONTECO_ECOSYSTEM}.${CONTECO_TYPE}.${CONTECO_NAME}"
    case "$1" in
        extract)
            container=$(docker create $imageName)
            executionplane docker cp $container:/conteco/git-repository "/conteco/pwd/${CONTECO_REALM}/${CONTECO_ECOSYSTEM}.${CONTECO_TYPE}.${CONTECO_NAME}"
            ;;
        load)
            executionplane docker image pull "$imageName:${CONTECO_TAG}"
            executionplane docker image tag "$imageName:${CONTECO_TAG}" "$imageName"
            ;;
        pull)
            executionplane docker image pull "$2"
            ;;
        rm)
            executionplane docker rmi "$2" $(extract-flags $@)
            ;;
        run)
            shift
            executionplane docker run $@
            ;;
        unload)
            executionplane docker rmi "$imageName" $(extract-flags $@)
            executionplane docker rmi "$imageName:${CONTECO_TAG}" $(extract-flags $@)
            ;;
        *)
            . executionplane-error "Method not recognised: $1."
            ;;
    esac
    executionplane-wait-for-output-parser
    . executionplane-complete
)
