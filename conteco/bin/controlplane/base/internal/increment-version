#!/usr/bin/env bash
versionpart=$1
rootPath=$2

executionplane-info "increment-version $versionpart $rootPath $CONTECO_TAG"

major=$( echo "$CONTECO_TAG" | cut -d "." -f 1 )
major=${major#"v"}
minor=$( echo "$CONTECO_TAG" | cut -d "." -f 2 )
revision=$( echo "$CONTECO_TAG" | cut -d "." -f 3 )
oldtext="$CONTECO_TAG"

if [[ "$versionpart" == "major" ]] ; then
	major=$(($major + 1))
	minor="0"
	revision="0"
elif [[ "$versionpart" == "minor" ]] ; then
	minor=$(($minor + 1))
	revision="0"
elif [[ "$versionpart" == "revision" ]] ; then
	revision=$(($revision + 1))
fi
version="v$major.$minor.$revision"
export CONTECO_TAG=$version

sedstring="s/$oldtext/$CONTECO_TAG/g"
sed -i "s/$oldtext/$CONTECO_TAG/g" "$rootPath/environment"
executionplane-info "Version increment: $oldtext >>> $CONTECO_TAG"
