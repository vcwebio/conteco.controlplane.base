#!/usr/bin/env bash
(
	export PATH="$CONTECO_EXECUTIONPLANE_APIINTERNALPATH_BASE"
	. executionplane-invoke "$0 $@"
	imageName="${@: -1}"
	rootPath="/conteco/pwd/${imageName}"
	. $rootPath/environment

	if [[ $# -gt 1 && "$1" == "--info" ]] ; then
		. info-summary build
		exit 0
	fi

	executionplane "--errors-only" docker image push "$CONTECO_REGISTRY$imageName:latest"
	if [[ "${CONTECO_TAG}" != "" ]] ; then
		executionplane "--errors-only" docker image push "$CONTECO_REGISTRY$imageName:${CONTECO_TAG}"
	fi
  executionplane-complete
)
