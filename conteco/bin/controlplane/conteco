#!/usr/bin/env bash

# The commandline interactive conteco handler
# It ports to the functional API conteco method
# the arguments are prefixed with the API conteco method and supplied to the .invoke method
# script waits until output-parser-tagged has finished to exit
if [[ "$CONTECO_FIFO_CONSOLE" == "active" ]] ; then
	echo "conteco $@" >&3
else
(
    export PATH="/conteco/bin/controlplane/internal:$CONTECO_EXECUTIONPLANE_ORIGINALPATH"
    .invoke $@ > >( output-parser-tagged ) 2> >( output-parser-tagged );
    wait-for-output-parser-tagged
)
fi
##########################################################

# If conteco runs not inline then it should issue the .invoke command to the output/processing console
# This needs setting up: conteco should only do the last command

# from processing/output console 
# mkfifo CONTECO_FIFO
# exec < CONTECO_FIFO

# from input console
# exec 3> CONTECO_FIFO;
# echo ".invoke $@ > >( output-parser-tagged ) 2> >( output-parser-tagged );" >&3
 