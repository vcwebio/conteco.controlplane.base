#!/usr/bin/env bash
selector=$(set-selector "${@: -1}")
shopt -s nullglob

if [[ "${@: -1}" == "--help" ]] ; then
	.invoke  $@ > >( output-parser-tagged ) 2> >( output-parser-tagged );
	wait-for-output-parser-tagged
else
	if [[ "$selector" == *"$" ]] ; then
		selector="${selector::-1}"
	else
		selector="$selector*"
	fi

	noSelection="true"
	if [[ "$1" == "console" ]] ; then
	  .invoke $@ > >( output-parser-tagged ) 2> >( output-parser-tagged );
	  wait-for-output-parser-tagged
	else
	  for f in $selector ;
	  do
	    noSelection="false"
	    .invoke $1 ${@:2:$#-2} $f > >( output-parser-tagged ) 2> >( output-parser-tagged );
	    wait-for-output-parser-tagged
	  done;
	fi
fi
